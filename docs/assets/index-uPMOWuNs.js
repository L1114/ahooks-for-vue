var X=Object.defineProperty;var V=(t,e,r)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var h=(t,e,r)=>(V(t,typeof e!="symbol"?e+"":e,r),r);import{i as z,j as J,k as y,l as $,m as K,n as w,w as Q,g as F}from"./app-sV-t5tpv.js";import{c as p,a as N}from"./commonjsHelpers-1J56E-h6.js";class Y{constructor(e,r,i,n){h(this,"count",0);h(this,"state",z({loading:!1,data:void 0,error:void 0,params:void 0}));h(this,"pluginImpls",[]);this.serviceRef=e,this.options=r,this.subscribe=i,this.initState=n,this.options=r||{};let o=r.defaultParams||[];this.state.params=Array.isArray(o)?o:[o]}getRawParams(){return J(this.state.params)||[]}userOptionsHook(e,...r){const i=this.options&&this.options[e];i&&i(...r)}pluginsLifecycleHook(e,...r){const i=this.pluginImpls.map(n=>{var o;return(o=n[e])==null?void 0:o.call(n,...r)}).filter(Boolean);return Object.assign({},...i)}run(...e){this.runAsync(...e).catch(r=>{this.options.onError||console.error(r)})}async runAsync(...e){this.count++;const r=this.count,{stopNow:i=!1}=this.pluginsLifecycleHook("onBefore",e);if(i)return new Promise(()=>{});try{this.state.params=e,this.userOptionsHook("onBefore",e),this.state.loading=!0;const n=await this.serviceRef(...e);return r!==this.count?new Promise(()=>{}):(this.pluginsLifecycleHook("onBefore",e),this.state.data=n,this.state.error=void 0,this.state.loading=!1,this.userOptionsHook("onSuccess",e,n),this.userOptionsHook("onFinally",e,n),this.pluginsLifecycleHook("onSuccess",e,n),this.pluginsLifecycleHook("onFinally",e,n),n)}catch(n){if(r!==this.count)return new Promise(()=>{});throw this.state.loading=!1,this.state.error=n,this.userOptionsHook("onError",e,void 0,n),this.userOptionsHook("onFinally",e,void 0,n),this.pluginsLifecycleHook("onError",e,void 0,n),this.pluginsLifecycleHook("onFinally",e,void 0,n),n}}cancel(){this.count++,this.state.loading=!1,this.pluginsLifecycleHook("onCancel")}mutate(e){this.state.data=e}refresh(){this.run(...getRawParams())}refreshAsync(){return this.runAsync(...getRawParams())}}const Z=(t,e={},r=[])=>{const i=new Y(t,e,()=>{},[]);return i.pluginImpls=r.map(n=>n(i,e)),{loading:y(i.state,"loading"),data:y(i.state,"data"),error:y(i.state,"error"),params:y(i.state,"params"),cancel:i.cancel.bind(i),refresh:i.refresh.bind(i),refreshAsync:i.refreshAsync.bind(i),run:i.run.bind(i),runAsync:i.runAsync.bind(i),mutate:i.mutate.bind(i)}};function tt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var P=tt,et=typeof p=="object"&&p&&p.Object===Object&&p,rt=et,nt=rt,it=typeof self=="object"&&self&&self.Object===Object&&self,ot=nt||it||Function("return this")(),B=ot,st=B,at=function(){return st.Date.now()},ut=at,ct=/\s/;function lt(t){for(var e=t.length;e--&&ct.test(t.charAt(e)););return e}var ft=lt,dt=ft,gt=/^\s+/;function mt(t){return t&&t.slice(0,dt(t)+1).replace(gt,"")}var bt=mt,vt=B,ht=vt.Symbol,G=ht,x=G,I=Object.prototype,yt=I.hasOwnProperty,pt=I.toString,b=x?x.toStringTag:void 0;function Tt(t){var e=yt.call(t,b),r=t[b];try{t[b]=void 0;var i=!0}catch{}var n=pt.call(t);return i&&(e?t[b]=r:delete t[b]),n}var jt=Tt,Ot=Object.prototype,St=Ot.toString;function $t(t){return St.call(t)}var wt=$t,L=G,Pt=jt,kt=wt,Rt="[object Null]",Et="[object Undefined]",A=L?L.toStringTag:void 0;function xt(t){return t==null?t===void 0?Et:Rt:A&&A in Object(t)?Pt(t):kt(t)}var Lt=xt;function At(t){return t!=null&&typeof t=="object"}var Ht=At,_t=Lt,Ct=Ht,Ft="[object Symbol]";function Nt(t){return typeof t=="symbol"||Ct(t)&&_t(t)==Ft}var Bt=Nt,Gt=bt,H=P,It=Bt,_=NaN,Mt=/^[-+]0x[0-9a-f]+$/i,Ut=/^0b[01]+$/i,Wt=/^0o[0-7]+$/i,qt=parseInt;function Dt(t){if(typeof t=="number")return t;if(It(t))return _;if(H(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=H(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Gt(t);var r=Ut.test(t);return r||Wt.test(t)?qt(t.slice(2),r?2:8):Mt.test(t)?_:+t}var Xt=Dt,Vt=P,S=ut,C=Xt,zt="Expected a function",Jt=Math.max,Kt=Math.min;function Qt(t,e,r){var i,n,o,c,s,l,f=0,a=!1,d=!1,T=!0;if(typeof t!="function")throw new TypeError(zt);e=C(e)||0,Vt(r)&&(a=!!r.leading,d="maxWait"in r,o=d?Jt(C(r.maxWait)||0,e):o,T="trailing"in r?!!r.trailing:T);function j(u){var g=i,m=n;return i=n=void 0,f=u,c=t.apply(m,g),c}function U(u){return f=u,s=setTimeout(v,e),a?j(u):c}function W(u){var g=u-l,m=u-f,E=e-g;return d?Kt(E,o-m):E}function k(u){var g=u-l,m=u-f;return l===void 0||g>=e||g<0||d&&m>=o}function v(){var u=S();if(k(u))return R(u);s=setTimeout(v,W(u))}function R(u){return s=void 0,T&&i?j(u):(i=n=void 0,c)}function q(){s!==void 0&&clearTimeout(s),f=0,i=l=n=s=void 0}function D(){return s===void 0?c:R(S())}function O(){var u=S(),g=k(u);if(i=arguments,n=this,l=u,g){if(s===void 0)return U(l);if(d)return clearTimeout(s),s=setTimeout(v,e),j(l)}return s===void 0&&(s=setTimeout(v,e)),c}return O.cancel=q,O.flush=D,O}var M=Qt;const Yt=N(M);var Zt=M,te=P,ee="Expected a function";function re(t,e,r){var i=!0,n=!0;if(typeof t!="function")throw new TypeError(ee);return te(r)&&(i="leading"in r?!!r.leading:i,n="trailing"in r?!!r.trailing:n),Zt(t,e,{leading:i,maxWait:e,trailing:n})}var ne=re;const ie=N(ne),oe=(t,{throttleWait:e,throttleLeading:r,throttleTrailing:i})=>{const n={};if(r!==void 0&&(n.leading=r),i!==void 0&&(n.trailing=i),e!==void 0&&e>0){const o=t.runAsync.bind(t),c=ie(s=>{s()},e,n);t.runAsync=(...s)=>new Promise((l,f)=>{c(()=>{o==null||o(...s).then(a=>l(a)).catch(a=>f(a))})})}return{onCancel:()=>{}}},se=(t,{debounceWait:e,debounceLeading:r,debounceTrailing:i,debounceMaxWait:n})=>{let o;const c={};if(r!==void 0&&(c.leading=r),i!==void 0&&(c.trailing=i),n!==void 0&&(c.maxWait=n),e!==void 0&&e>0){const s=t.runAsync.bind(t);o=Yt(l=>{l()},e,c),t.runAsync=(...l)=>new Promise((f,a)=>{o(()=>{s==null||s(...l).then(d=>f(d)).catch(d=>a(d))})})}return{onCancel:()=>{o==null||o.cancel()}}},ae=(t,{manual:e,ready:r=F(!0)})=>{let i=!1;$(()=>{const o=K(r)?r.value:!!r;i=!o,!e&&o&&t.run(...t.getRawParams())}),w(()=>{t.cancel(),n()});const n=Q(r,o=>{i=!o,!e&&o&&t.run(...t.getRawParams())});return{onBefore:()=>({stopNow:i})}},ue=(t,e,r={})=>{const i=o=>e(o);let n;$(()=>{typeof r.target=="function"&&(n=r.target()),n=n||window,n!=null&&n.addEventListener&&n.addEventListener(t,i,{capture:r.capture,once:r.once,passive:r.passive})}),w(()=>{n!=null&&n.removeEventListener&&n.removeEventListener(t,i,{capture:r.capture})})},ce=t=>{const e=F("visible");return $(()=>{ue("visibilitychange",()=>{e.value=document.visibilityState,t&&t(document.visibilityState)},{target:document})}),e},le=(t,{pollingInterval:e,pollingWhenHidden:r=!0,pollingErrorRetryCount:i=-1})=>{if(!e||e<=0)return{};let n=!1,o=0,c;const s=a=>{a&&(n=a),clearTimeout(c)},l=t.run.bind(t);r||ce(a=>{if(a==="visible"&&!n)return f(t.getRawParams());if(a==="hidden")return s()}),t.run=(...a)=>{const d=a!=null&&a.length?a:t.getRawParams();l(...d),f(d)};const f=a=>{s(),n=!1,c=setTimeout(()=>{t.run(...a||[])},e)};return w(()=>s(!0)),{onError:()=>{o++,i!==void 0&&i!==-1&&o>=i&&s(!0)},onSuccess:()=>{o=0},onCancel(){s(!0)}}},fe=(t,e,r)=>Z(t,e,[...r||[],oe,se,ae,le]),be=fe;export{be as a,ue as m,ce as u};
