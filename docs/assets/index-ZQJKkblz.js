var Y=Object.defineProperty;var Z=(t,e,r)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var T=(t,e,r)=>(Z(t,typeof e!="symbol"?e+"":e,r),r);import{h as ee,i as M,j as $,k as O,l as te,m as re,p as U,w,g as P}from"./app-m2-sF_Mn.js";import{c as L,a as W}from"./commonjsHelpers-1J56E-h6.js";class ne{constructor(e,r,n,i){T(this,"count",0);T(this,"state",ee({loading:!1,data:void 0,error:void 0,params:void 0}));T(this,"pluginImpls",[]);T(this,"lastFetchTime",0);T(this,"loadingDelayTimer");this.serviceRef=e,this.options=r,this.subscribe=n,this.initState=i,this.options=r||{};let s=r.defaultParams||[];this.state.params=Array.isArray(s)?s:[s]}setLoading(e){const r=Number(this.options.loadingDelay)||0;e?this.loadingDelayTimer=setTimeout(()=>{this.state.loading=!0},r):(clearTimeout(this.loadingDelayTimer),this.state.loading=!1)}getRawParams(){return M(this.state.params)||[]}userOptionsHook(e,...r){const n=this.options&&this.options[e];n&&n(...r)}pluginsLifecycleHook(e,...r){const n=this.pluginImpls.map(i=>{var s;return(s=i[e])==null?void 0:s.call(i,...r)}).filter(Boolean);return Object.assign({},...n)}run(...e){this.runAsync(...e).catch(r=>{this.options.onError||console.error(r)})}async runAsync(...e){this.count++;const r=this.count,{stopNow:n=!1}=this.pluginsLifecycleHook("onBefore",e);if(n)return new Promise(()=>{});try{this.state.params=e,this.userOptionsHook("onBefore",e),this.setLoading(!0),this.lastFetchTime=Date.now(),this.pluginsLifecycleHook("onRequest",e);const i=await this.serviceRef(...e);return r!==this.count?new Promise(()=>{}):(this.state.data=i,this.state.error=void 0,this.setLoading(!1),this.userOptionsHook("onSuccess",e,i),this.userOptionsHook("onFinally",e,i),this.pluginsLifecycleHook("onSuccess",e,i),this.pluginsLifecycleHook("onFinally",e,i),i)}catch(i){if(r!==this.count)return new Promise(()=>{});throw this.setLoading(!1),this.state.error=i,this.userOptionsHook("onError",e,void 0,i),this.userOptionsHook("onFinally",e,void 0,i),this.pluginsLifecycleHook("onError",e,void 0,i),this.pluginsLifecycleHook("onFinally",e,void 0,i),i}}cancel(){this.count++,this.setLoading(!1),this.pluginsLifecycleHook("onCancel")}mutate(e){this.state.data=e}refresh(){this.run(...this.getRawParams())}refreshAsync(){return this.runAsync(...this.getRawParams())}}const ie=(t,e={},r=[])=>{const n=new ne(t,e,()=>{},[]);return n.pluginImpls=r.map(i=>i(n,e)),{loading:$(n.state,"loading"),data:$(n.state,"data"),error:$(n.state,"error"),params:$(n.state,"params"),cancel:n.cancel.bind(n),refresh:n.refresh.bind(n),refreshAsync:n.refreshAsync.bind(n),run:n.run.bind(n),runAsync:n.runAsync.bind(n),mutate:n.mutate.bind(n)}};function se(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var x=se,ae=typeof L=="object"&&L&&L.Object===Object&&L,oe=ae,ue=oe,le=typeof self=="object"&&self&&self.Object===Object&&self,ce=ue||le||Function("return this")(),q=ce,fe=q,de=function(){return fe.Date.now()},me=de,ge=/\s/;function ve(t){for(var e=t.length;e--&&ge.test(t.charAt(e)););return e}var he=ve,be=he,ye=/^\s+/;function Te(t){return t&&t.slice(0,be(t)+1).replace(ye,"")}var we=Te,je=q,Se=je.Symbol,V=Se,H=V,X=Object.prototype,Oe=X.hasOwnProperty,Ee=X.toString,S=H?H.toStringTag:void 0;function $e(t){var e=Oe.call(t,S),r=t[S];try{t[S]=void 0;var n=!0}catch{}var i=Ee.call(t);return n&&(e?t[S]=r:delete t[S]),i}var Le=$e,Pe=Object.prototype,Re=Pe.toString;function ke(t){return Re.call(t)}var Fe=ke,D=V,xe=Le,Ae=Fe,_e="[object Null]",Ce="[object Undefined]",N=D?D.toStringTag:void 0;function He(t){return t==null?t===void 0?Ce:_e:N&&N in Object(t)?xe(t):Ae(t)}var De=He;function Ne(t){return t!=null&&typeof t=="object"}var Be=Ne,Ge=De,Ie=Be,Me="[object Symbol]";function Ue(t){return typeof t=="symbol"||Ie(t)&&Ge(t)==Me}var We=Ue,qe=we,B=x,Ve=We,G=NaN,Xe=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,ze=/^0o[0-7]+$/i,Je=parseInt;function Ke(t){if(typeof t=="number")return t;if(Ve(t))return G;if(B(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=B(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=qe(t);var r=pe.test(t);return r||ze.test(t)?Je(t.slice(2),r?2:8):Xe.test(t)?G:+t}var Qe=Ke,Ye=x,k=me,I=Qe,Ze="Expected a function",et=Math.max,tt=Math.min;function rt(t,e,r){var n,i,s,u,a,o,f=0,l=!1,c=!1,m=!0;if(typeof t!="function")throw new TypeError(Ze);e=I(e)||0,Ye(r)&&(l=!!r.leading,c="maxWait"in r,s=c?et(I(r.maxWait)||0,e):s,m="trailing"in r?!!r.trailing:m);function h(d){var v=n,j=i;return n=i=void 0,f=d,u=t.apply(j,v),u}function b(d){return f=d,a=setTimeout(E,e),l?h(d):u}function y(d){var v=d-o,j=d-f,C=e-v;return c?tt(C,s-j):C}function A(d){var v=d-o,j=d-f;return o===void 0||v>=e||v<0||c&&j>=s}function E(){var d=k();if(A(d))return _(d);a=setTimeout(E,y(d))}function _(d){return a=void 0,m&&n?h(d):(n=i=void 0,u)}function K(){a!==void 0&&clearTimeout(a),f=0,n=o=i=a=void 0}function Q(){return a===void 0?u:_(k())}function R(){var d=k(),v=A(d);if(n=arguments,i=this,o=d,v){if(a===void 0)return b(o);if(c)return clearTimeout(a),a=setTimeout(E,e),h(o)}return a===void 0&&(a=setTimeout(E,e)),u}return R.cancel=K,R.flush=Q,R}var p=rt;const nt=W(p);var it=p,st=x,at="Expected a function";function ot(t,e,r){var n=!0,i=!0;if(typeof t!="function")throw new TypeError(at);return st(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),it(t,e,{leading:n,maxWait:e,trailing:i})}var ut=ot;const lt=W(ut),ct=(t,{throttleWait:e,throttleLeading:r,throttleTrailing:n})=>{const i={};if(r!==void 0&&(i.leading=r),n!==void 0&&(i.trailing=n),e!==void 0&&e>0){const s=t.runAsync.bind(t),u=lt(a=>{a()},e,i);t.runAsync=(...a)=>new Promise((o,f)=>{u(()=>{s==null||s(...a).then(l=>o(l)).catch(l=>f(l))})})}return{onCancel:()=>{}}},ft=(t,{debounceWait:e,debounceLeading:r,debounceTrailing:n,debounceMaxWait:i})=>{let s;const u={};if(r!==void 0&&(u.leading=r),n!==void 0&&(u.trailing=n),i!==void 0&&(u.maxWait=i),e!==void 0&&e>0){const a=t.runAsync.bind(t);s=nt(o=>{o()},e,u),t.runAsync=(...o)=>new Promise((f,l)=>{s(()=>{a==null||a(...o).then(c=>f(c)).catch(c=>l(c))})})}return{onCancel:()=>{s==null||s.cancel()}}},dt=!!(typeof window<"u"&&window.document&&window.document.createElement),g=t=>O(t)?t.value:te(t)?M(t):t,z=(t,e)=>{if(!dt)return null;const r=e===void 0?window:e;let n=g(t);return typeof n=="function"&&(n=g(n())),n||r},mt=(t,{manual:e,ready:r=P(!0)})=>{let n=!1;re(()=>{const s=g(r);n=!s,!e&&s&&t.run(...t.getRawParams())}),U(()=>{t.cancel(),i()});const i=w(r,s=>{n=!g(r),!e&&s&&t.run(...t.getRawParams())});return{onBefore:()=>({stopNow:n})}},F=(t,e,r={})=>{const n=o=>e(o);let i=!1,s=z(r==null?void 0:r.target);const u=o=>{o&&o(),a(),!(!(s!=null&&s.addEventListener)||i)&&s.addEventListener(t,n,{capture:r.capture,once:r.once,passive:r.passive})},a=o=>{o&&o(),s!=null&&s.removeEventListener&&s.removeEventListener(t,n,{capture:r.capture})};return u(),O(r==null?void 0:r.target)&&w(r==null?void 0:r.target,o=>{a(),s=o,u()}),{stop:()=>a(()=>i=!0),restart:()=>u(()=>i=!1)}},J=t=>{const e=P("visible"),{stop:r,restart:n}=F("visibilitychange",()=>{e.value=document.visibilityState,t&&t(document.visibilityState)});return{documentVisibility:e,restart:n,stop:r}},gt=(t,{pollingInterval:e,pollingWhenHidden:r=!0,pollingErrorRetryCount:n=-1})=>{if(!e||e<=0)return{};let i=!1,s=0,u;const a=l=>{l&&(i=l),clearTimeout(u)},o=t.run.bind(t);r||J(l=>{if(l==="visible"&&!i)return f(t.getRawParams());a()}),t.run=(...l)=>{o(...l),f(l)};const f=l=>{a(),i=!1,u=setTimeout(()=>{t.run(...l||[])},e)};return U(()=>a(!0)),{onError:()=>{s++,n!==void 0&&n!==-1&&s>=n&&a(!0)},onSuccess:()=>{s=0},onCancel(){a(!0)}}},vt=(t,e={})=>{const r=P(!1);let n=z(t,null),i=()=>{},s=()=>{},u=()=>{i(),s()};const a=(e==null?void 0:e.focusin)||"focusin",o=(e==null?void 0:e.focusout)||"focusout",f=m=>F(a,h=>{var b,y;r.value||(r.value=!0,(b=e==null?void 0:e.onFocus)==null||b.call(e,h),(y=e==null?void 0:e.onChange)==null||y.call(e,!0))},{target:m}),l=m=>F(o,h=>{var b,y;r.value&&(r.value=!1,(b=e==null?void 0:e.onBlur)==null||b.call(e,h),(y=e==null?void 0:e.onChange)==null||y.call(e,!0))},{target:m});let c=()=>{u(),r.value=!1,i=f(n).stop,s=l(n).stop};return c(),w(t,m=>{u(),n=m,m&&c()}),{stop:()=>u(),restart:()=>c(),isFocusWithin:r}},ht=(t,{refreshOnWindowFocus:e,focusTimespan:r=5e3})=>{const n=()=>{Date.now()-t.lastFetchTime>g(r)&&t.refresh()};let i=()=>{},s=()=>{};const u=()=>{i(),s()};let a=()=>{u(),i=J(o=>{o==="visible"&&n()}).stop,s=vt(()=>window,{onFocus:()=>{n()},focusin:"focus",focusout:"blur"}).stop};return g(e)&&a(),w([e,r].filter(o=>O(o)),([o])=>{o||o===void 0?a():u()}),{onCancel:()=>{u()}}},bt=(t,{retryCount:e=0,retryInterval:r})=>{const n=P(0);let i=!1;const s=()=>{let c=g(r);return c=c>=0?c:Math.min(30*1e3,Math.pow(2,n.value+1)*1e3),c};let u=g(e),a=s();const o=()=>Number(u)>0||u===-1;let f=o(),l;return w([e,n].filter(c=>O(c)),()=>{u=g(e),f=o(),a=s(),f||clearTimeout(l)}),w([r].filter(c=>O(c)),()=>{n.value=0,a=s()}),{onRequest:()=>(i&&f&&(n.value++,console.log(`错误重试:第${n.value}次`)),clearTimeout(l),{}),onSuccess:()=>{n.value=0,i=!1},onError:()=>{i=!0,f&&(n.value<u||u===-1)&&(console.log("retryInterval :>> ",a),clearTimeout(l),l=setTimeout(()=>{t.refresh()},a))},onFinally:()=>{},onCancel:()=>{clearTimeout(l),f=!1}}},yt=(t,e,r)=>ie(t,e,[...r||[],ct,ft,gt,ht,bt,mt]),St=yt;export{vt as a,St as b,F as m,J as u};
